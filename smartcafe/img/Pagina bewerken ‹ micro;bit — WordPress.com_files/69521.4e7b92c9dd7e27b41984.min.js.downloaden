"use strict";(globalThis.webpackChunkcalypso=globalThis.webpackChunkcalypso||[]).push([[69521],{"./blocks/all-sites/index.jsx":(e,s,t)=>{t.d(s,{Z:()=>f});var i=t("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=t("../packages/calypso-config/src/index.ts"),n=t("../node_modules/classnames/index.js"),r=t.n(n),l=t("../packages/i18n-calypso/src/index.js"),a=(t("../node_modules/prop-types/index.js"),t("../node_modules/react/index.js")),c=t("../node_modules/react-redux/es/index.js"),d=t("./components/count/index.jsx"),h=t("./state/current-user/selectors.js"),u=t("./state/selectors/get-sites.js"),p=t("./blocks/site-icon/index.jsx");class g extends a.Component{getMaxSites(){return this.props.sites.slice(0,10)}getSitesWithIcons(){return this.props.sites.filter((e=>e.icon)).slice(0,10)}getIcons(){return[...new Set([].concat(this.getSitesWithIcons(),this.getMaxSites()))].slice(0,10).map((e=>a.createElement(p.Z,{site:e,key:e.ID,size:14})))}render(){const e=this.getIcons(),s=`all-sites-icon has-${this.getMaxSites().length}-icons`;return a.createElement("div",{className:s},e)}}class m extends a.Component{constructor(...e){super(...e),(0,i.Z)(this,"onSelect",(e=>{this.props.onSelect(e)}))}renderSiteCount(){return a.createElement(d.Z,{count:this.props.count})}render(){const{title:e,href:s,domain:t,sites:i,translate:o,isHighlighted:n,isSelected:l,showCount:c}=this.props,d=r()({"all-sites":!0,"is-selected":l,"is-highlighted":n});return a.createElement("div",{className:d},a.createElement("a",{className:"all-sites__content site__content",href:s,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,onClick:this.onSelect},c&&this.renderSiteCount(),a.createElement("div",{className:"all-sites__info site__info"},a.createElement("span",{className:"all-sites__title site__title"},e||o("All My Sites")),t&&a.createElement("span",{className:"all-sites__domain site__domain"},t),a.createElement(g,{sites:i}))))}}(0,i.Z)(m,"defaultProps",{onSelect:()=>{},href:null,isSelected:!1,isHighlighted:!1,showCount:!0,domain:""});const S=({visible:e=!0})=>e,f=(0,c.$j)(((e,s)=>{const{sites:t=(0,u.Z)(e),userSitesCount:i=(0,h.f0)(e)}=s,n=t?.filter(S);return{sites:o.ZP.isEnabled("realtime-site-count")?n:t,count:o.ZP.isEnabled("realtime-site-count")?n.length:i}}))((0,l.NC)(m))},"./components/search-sites/index.js":(e,s,t)=>{t.d(s,{Z:()=>h});var i=t("../node_modules/@babel/runtime/helpers/esm/extends.js"),o=t("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=t("../node_modules/lodash-es/get.js"),r=t("../node_modules/react/index.js"),l=t("../node_modules/react-redux/es/index.js"),a=t("./state/selectors/get-sites.js");const c=(e,s,t)=>e.filter((e=>((e,s,t)=>t.some((t=>(0,n.Z)(e,t,"").toLowerCase().indexOf(s)>-1)))(e,s,t))),d=e=>({sites:(0,a.Z)(e)});function h(e){const s=e.displayName||e.name||"";class t extends r.Component{constructor(...e){super(...e),(0,o.Z)(this,"state",{term:null}),(0,o.Z)(this,"setSearchTerm",(e=>this.setState({term:e})))}getSearchResults(){return this.state.term?c(this.props.sites,this.state.term.toLowerCase(),["name","URL"]):null}render(){return r.createElement(e,(0,i.default)({},this.props,{searchSites:this.setSearchTerm,sitesFound:this.getSearchResults()}))}}const n=(0,l.$j)(d)(t);return n.displayName=`SearchSites(${s})`,n}},"./components/site-selector/index.jsx":(e,s,t)=>{t.d(s,{Z:()=>J});var i=t("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=t("../packages/calypso-url/src/url-type.ts"),n=t("../packages/calypso-url/src/url-parts.ts"),r=t("../packages/calypso-url/src/format.ts"),l=t("../node_modules/classnames/index.js"),a=t.n(l),c=t("../node_modules/debug/src/browser.js"),d=t.n(c),h=t("../packages/i18n-calypso/src/index.js"),u=t("../node_modules/lodash-es/find.js"),p=t("../node_modules/lodash-es/isEmpty.js"),g=t("../node_modules/lodash-es/filter.js"),m=t("../node_modules/lodash-es/includes.js"),S=t("../node_modules/lodash-es/get.js"),f=t("../node_modules/lodash-es/flow.js"),b=t("../node_modules/page/page.js"),v=t.n(b),_=(t("../node_modules/prop-types/index.js"),t("../node_modules/react/index.js")),j=t("../node_modules/react-dom/index.js"),x=t("../node_modules/react-redux/es/index.js"),Z=t("./blocks/all-sites/index.jsx"),y=t("./blocks/site/index.jsx"),w=t("./blocks/site/placeholder.jsx"),E=t("./components/search/index.jsx"),k=t("./components/search-sites/index.js"),M=t("./lib/scroll-into-viewport/index.js"),C=t("./state/current-user/selectors.js"),I=t("./state/preferences/selectors.js"),N=t("./state/selectors/are-all-sites-single-user.js"),H=t("./state/selectors/get-sites.js"),R=t("./state/selectors/get-visible-sites.js"),A=t("./state/selectors/has-loaded-sites.js"),T=t("./state/sites/selectors/get-site.js"),D=t("./state/sites/selectors/has-all-sites-list.js"),L=t("./state/ui/selectors/get-selected-site.js"),P=t("../packages/components/src/button/index.tsx"),K=t("../packages/components/src/gridicon/index.tsx"),$=t("./lib/jetpack/is-jetpack-cloud.ts"),F=t("./state/analytics/actions/record.js"),U=t("./state/selectors/get-onboarding-url.js");class O extends _.Component{constructor(...e){super(...e),(0,i.Z)(this,"recordAddNewSite",(()=>{const e=(0,$.Z)()?"calypso_add_new_jetpack_click":"calypso_add_new_wordpress_click";this.props.recordTracksEvent(e)}))}render(){const{onboardingUrl:e,translate:s}=this.props;return _.createElement("span",{className:"site-selector__add-new-site"},_.createElement(P.Z,{borderless:!0,href:`${e}?ref=calypso-selector`,onClick:this.recordAddNewSite},_.createElement(K.Z,{icon:"add-outline"})," ",s("Add new site")))}}const Y=(0,x.$j)((e=>({onboardingUrl:(0,U.Z)(e)})),{recordTracksEvent:F.jN})((0,h.NC)(O)),B=e=>(0,$.Z)()?(e=>`jetpack_${e}`)(e):e;function V(e){return(0,S.Z)(e,B("site_count"),0)}function X(e){return(0,S.Z)(e,B("visible_site_count"),0)}const z="ALL_SITES",G=()=>{},W=d()("calypso:site-selector");class q extends _.Component{constructor(...e){super(...e),(0,i.Z)(this,"state",{highlightedIndex:-1,showSearch:!1,isKeyboardEngaged:!1}),(0,i.Z)(this,"onSearch",(e=>{this.props.searchSites(e),this.setState({highlightedIndex:e?0:-1,showSearch:!!e||this.state.showSearch,isKeyboardEngaged:!0})})),(0,i.Z)(this,"onKeyDown",(e=>{const s=this.visibleSites.length;if(0===s||e.shiftKey)return;const{highlightedSiteId:t,highlightedIndex:i}=this.computeHighlightedSite();let o=null;switch(e.key){case"ArrowUp":o=i-1,o<0&&(o=s-1);break;case"ArrowDown":o=i+1,o>=s&&(o=0);break;case"Enter":t&&(t===z?this.onSiteSelect(e,z):this.onSiteSelect(e,t))}null!==o&&(this.lastMouseHover=null,this.setState({highlightedIndex:o,isKeyboardEngaged:!0}))})),(0,i.Z)(this,"onSiteSelect",((e,s)=>{const t=this.props.onSiteSelect(s);if(this.props.onClose(e,s),!this.siteSelectorRef)return;const i=j.findDOMNode(this.siteSelectorRef);i&&(i.scrollTop=0),t||this.props.navigateToSite(s,this.props)})),(0,i.Z)(this,"onAllSitesSelect",(e=>{this.onSiteSelect(e,z)})),(0,i.Z)(this,"onSiteHover",((e,s)=>{this.lastMouseHover!==s&&(W(`${s} hovered`),this.lastMouseHover=s)})),(0,i.Z)(this,"onAllSitesHover",(()=>{this.lastMouseHover!==z&&(W("ALL_SITES hovered"),this.lastMouseHover=z)})),(0,i.Z)(this,"onMouseLeave",(()=>{W("mouse left site selector - nothing hovered anymore"),this.lastMouseHover=null})),(0,i.Z)(this,"onMouseMove",(e=>{e.pageX===this.lastMouseMoveX&&e.pageY===this.lastMouseMoveY||(this.lastMouseMoveY=e.pageY,this.lastMouseMoveX=e.pageX,this.state.isKeyboardEngaged&&this.setState({isKeyboardEngaged:!1}))})),(0,i.Z)(this,"setSiteSelectorRef",(e=>this.siteSelectorRef=e))}componentDidUpdate(e,s){this.state.isKeyboardEngaged&&s.highlightedIndex!==this.state.highlightedIndex&&this.scrollToHighlightedSite()}scrollToHighlightedSite(){if(!this.siteSelectorRef)return;const e=j.findDOMNode(this.siteSelectorRef);if(!e)return;const s=e.querySelector(".site.is-highlighted, .site-selector .all-sites.is-highlighted");s&&(0,M.Z)(s,{block:"nearest",scrollMode:"if-needed"})}computeHighlightedSite(){let e,s;return this.state.isKeyboardEngaged?(W("using highlight from last keyboard interaction"),e=this.visibleSites[this.state.highlightedIndex],s=this.state.highlightedIndex):this.lastMouseHover?(W(`restoring highlight from last mouse hover (${this.lastMouseHover})`),e=this.props.highlightedSiteId||this.lastMouseHover,s=this.visibleSites.indexOf(e)):(W("resetting highlight as mouse left site selector"),e=null,s=-1),{highlightedSiteId:e,highlightedIndex:s}}isSelected(e){const s=this.props.selected||this.props.selectedSite;return e===z&&null===s||s===e.ID||s===e.domain||s===e.slug}isHighlighted(e){return this.state.isKeyboardEngaged&&this.visibleSites.indexOf(e)===this.state.highlightedIndex}shouldShowGroups(){return this.props.groups}sitesToBeRendered(){let e;return e=this.props.sitesFound?this.props.sitesFound:this.props.visibleSites,this.props.filter&&(e=e.filter(this.props.filter)),this.props.hideSelected&&this.props.selected&&(e=e.filter((e=>e.slug!==this.props.selected))),e}shouldRenderRecentSites(){return this.props.showRecentSites&&this.shouldShowGroups()&&!this.props.sitesFound}renderAllSites(){if(!this.props.showAllSites||this.props.sitesFound||!this.props.allSitesPath)return null;this.visibleSites.push(z);const e=this.isHighlighted(z);return _.createElement(Z.Z,{key:"selector-all-sites",sites:this.props.sites,onSelect:this.onAllSitesSelect,onMouseEnter:this.onAllSitesHover,isHighlighted:e,isSelected:this.isSelected(z)})}renderRecentSites(e){if(!this.shouldRenderRecentSites())return null;const s=[];for(const t of this.props.recentSites){const i=(0,u.Z)(e,{ID:t});i&&s.push(i)}if((0,p.Z)(s))return null;const t=s.map(this.renderSite,this);return _.createElement("div",{className:"site-selector__recent"},t)}renderSites(e){if(!this.props.hasAllSitesList)return _.createElement(w.Z,{key:"site-placeholder"});if(this.shouldRenderRecentSites()){const s=this.props.recentSites;e=(0,g.Z)(e,(({ID:e})=>!(0,m.Z)(s,e)))}const s=e.map(this.renderSite,this);return s.length?s:_.createElement("div",{className:"site-selector__no-results"},this.props.translate("No sites found"))}renderSite(e){if(!e)return null;this.visibleSites.push(e.ID);const s=this.isHighlighted(e.ID);return _.createElement(y.Z,{site:e,key:"site-"+e.ID,indicator:this.props.indicator,onSelect:this.onSiteSelect,onMouseEnter:this.onSiteHover,isHighlighted:s,isSelected:this.isSelected(e)})}render(){if(this.props.isPlaceholder)return _.createElement("div",{className:"site-selector"});const e=this.props.siteCount-this.props.visibleSiteCount,s=a()("site-selector","sites-list",this.props.className,{"is-large":this.props.siteCount>6||e>0||this.state.showSearch,"is-single":1===this.props.visibleSiteCount,"is-hover-enabled":!this.state.isKeyboardEngaged});this.visibleSites=[];const t=this.sitesToBeRendered();return _.createElement("div",{className:s,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},_.createElement(E.Z,{onSearch:this.onSearch,delaySearch:!0,autoFocus:this.props.autoFocus,disabled:!this.props.hasLoadedSites,onSearchClose:this.props.onClose,onKeyDown:this.onKeyDown}),_.createElement("div",{className:"site-selector__sites",ref:this.setSiteSelectorRef},this.renderAllSites(),this.renderRecentSites(t),this.renderSites(t),e>0&&!this.props.sitesFound&&_.createElement("span",{className:"site-selector__hidden-sites-message"},this.props.translate("%(hiddenSitesCount)d more hidden site. {{a}}Change{{/a}}.{{br/}}Use search to access it.","%(hiddenSitesCount)d more hidden sites. {{a}}Change{{/a}}.{{br/}}Use search to access them.",{count:e,args:{hiddenSitesCount:e},components:{br:_.createElement("br",null),a:_.createElement("a",{href:"https://dashboard.wordpress.com/wp-admin/index.php?page=my-blogs&show=hidden",className:"site-selector__manage-hidden-sites",target:"_blank",rel:"noopener noreferrer"})}}))),this.props.showAddNewSite&&_.createElement(Y,null))}}(0,i.Z)(q,"defaultProps",{sites:{},showAddNewSite:!1,showAllSites:!1,siteBasePath:!1,indicator:!1,hideSelected:!1,selected:null,onClose:G,onSiteSelect:G,groups:!1,autoFocus:!1});const J=(0,f.Z)(h.NC,k.Z,(0,x.$j)((e=>{const s=(0,C.ts)(e);return{hasLoadedSites:(0,A.Z)(e),sites:(0,H.Z)(e),showRecentSites:(0,S.Z)(s,"visible_site_count",0)>11,recentSites:(0,I.Oz)(e,"recentSites"),siteCount:V(s),visibleSiteCount:X(s),selectedSite:(0,L.Z)(e),visibleSites:(0,R.Z)(e),allSitesSingleUser:(0,N.Z)(e),hasAllSitesList:(0,D.Z)(e)}}),{navigateToSite:(e,{allSitesPath:s,allSitesSingleUser:t,siteBasePath:i})=>(l,a)=>{const c=a(),d=function(){const l=(0,T.Z)(c,e);if(W("getPathnameForSite",e,l),e===z){const e=t?"/posts":"/posts/my";return s.replace(/^\/posts\b(\/my)?/,e).replace(/^\/stats\/insights\/?$/,"/stats/day")}if(i){const e=function(e){let s=i;const t=e.jetpack||e.single_user_site?"/posts":"/posts/my";s=s.replace(/^\/posts\b(\/my)?/,t),s.match(/^\/stats\/(post|page)\//)&&(s="/stats");s.match(/^\/domains\/manage\//)&&(s="/domains/manage");s.match(/^\/email\//)&&(s="/email");if(s.match(/^\/store\/stats\//)){e.jetpack&&e.options&&e.options.woocommerce_is_active||(s="/stats/day")}s.match(/^\/backup\/.*\/(download|restore|detail)/)&&(s="/backup");return s}(l),s=(0,o.D)(e),{origin:t,pathname:a,search:c}=(0,n.A)(e),d=`${a}/${l.slug}`;try{const e=(0,n.C)({origin:t||window.location.origin,pathname:d,search:c});return(0,r.Z)(e,s)}catch{return null}}}();d&&v()(d)}}))(q)},"./lib/scroll-into-viewport/index.js":(e,s,t)=>{t.d(s,{Z:()=>r});const i="undefined"!=typeof document&&document.documentElement&&"scrollBehavior"in document.documentElement.style;function o(e,s,t,i=0){return i+=e[s],e[t]?o(e[t],s,t,i):i}function n(e,s,t){const i=o(e,"offsetTop","offsetParent");if(!function(e,s){const t=window.scrollY,i=document.documentElement.clientHeight+window.scrollY;return e>t&&s<i}(i,i+e.offsetHeight)||"if-needed"!==t)try{window.scroll({top:i,left:0,behavior:s})}catch(e){window.scrollTo(0,i)}}function r(e,s={}){const{behavior:t="auto",block:o="start",scrollMode:r="always",...l}=s;if(e)if(!e.scrollIntoViewIfNeeded||"auto"!==t&&i||"center"!==o&&"nearest"!==o||"if-needed"!==r||void 0!==l){if(e.scrollIntoView)try{return void e.scrollIntoView(s)}catch(e){}n(e,t,r)}else e.scrollIntoViewIfNeeded("center"===o)}},"./state/selectors/are-all-sites-single-user.js":(e,s,t)=>{t.d(s,{Z:()=>r});var i=t("../packages/state-utils/src/index.ts"),o=t("./state/selectors/get-sites-items.js"),n=t("./state/sites/selectors/is-single-user-site.js");const r=(0,i.P1)((e=>{const s=Object.keys((0,o.Z)(e));return!!s.length&&s.every((s=>(0,n.Z)(e,s)))}),o.Z)},"./state/selectors/get-visible-sites.js":(e,s,t)=>{t.d(s,{Z:()=>r});var i=t("../packages/state-utils/src/index.ts"),o=t("./state/selectors/get-sites-items.js"),n=t("./state/sites/selectors/get-site.js");const r=(0,i.P1)((e=>Object.values((0,o.Z)(e)).filter((e=>!0===e.visible)).map((s=>(0,n.Z)(e,s.ID)))),(e=>[(0,o.Z)(e)]))},"./state/selectors/has-loaded-sites.js":(e,s,t)=>{function i(e){return null!==e.sites.items}t.d(s,{Z:()=>i})}}]);