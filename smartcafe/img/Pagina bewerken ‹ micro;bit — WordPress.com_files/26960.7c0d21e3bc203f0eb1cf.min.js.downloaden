"use strict";(globalThis.webpackChunkcalypso=globalThis.webpackChunkcalypso||[]).push([[26960],{"./blocks/site/index.jsx":(e,t,s)=>{s.d(t,{Z:()=>q});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("../packages/calypso-config/src/index.ts"),a=s("../packages/components/src/gridicon/index.tsx"),o=s("../node_modules/classnames/index.js"),r=s.n(o),c=s("../packages/i18n-calypso/src/index.js"),l=s("../node_modules/page/page.js"),p=s.n(l),d=(s("../node_modules/prop-types/index.js"),s("../node_modules/react/index.js")),h=s("../node_modules/react-redux/es/index.js"),u=s("./blocks/site-icon/index.jsx"),m=s("../node_modules/@babel/runtime/helpers/esm/extends.js"),_=s("../packages/components/src/button/index.tsx"),g=s("./components/animate/index.jsx"),v=s("./components/data/query-site-connection-status/index.jsx"),k=s("./components/external-link/index.jsx"),E=s("./state/analytics/actions/record.js"),x=s("./state/analytics/actions/compose-analytics.js"),b=s("./state/selectors/can-current-user.js"),j=s("./state/selectors/get-site-connection-status.js"),Z=s("./state/selectors/is-site-automated-transfer.js"),f=s("./state/sites/selectors/is-jetpack-site.js"),y=s("./state/selectors/get-raw-site.js");function I(e,t){return(0,y.Z)(e,t)?.updates??null}const w=e=>d.createElement(k.Z,(0,m.default)({icon:!0,iconSize:12,target:"_blank"},e));class C extends d.Component{constructor(...e){super(...e),(0,i.Z)(this,"state",{expand:!1}),(0,i.Z)(this,"toggleExpand",(()=>{this.setState({expand:!this.state.expand});const e=this.state.expand?"Collapse":"Expand";this.props.recordGoogleEvent("Site-Indicator",`Clicked to ${e} the Site Indicator`)})),(0,i.Z)(this,"handlePluginsUpdate",(()=>{const{siteUpdates:e}=this.props;this.recordEvent("Clicked updates available link to plugins updates",e&&e.total)})),(0,i.Z)(this,"handleThemesUpdate",(()=>{const{siteUpdates:e}=this.props;this.recordEvent("Clicked updates available link to theme updates",e&&e.total)})),(0,i.Z)(this,"handleCoreUpdate",(()=>{this.recordEvent("Clicked updates available link to WordPress updates",1)})),(0,i.Z)(this,"handleMultipleUpdate",(()=>{const{siteUpdates:e}=this.props;this.recordEvent("Clicked updates available link for multiple updates",e&&e.total)})),(0,i.Z)(this,"handleGenericUpdate",(()=>{const{siteUpdates:e}=this.props;this.props.recordGoogleEvent("Site-Indicator","Clicked updates available link to wp-admin updates","Total Updates",e&&e.total)}))}hasUpdate(){const{siteUpdates:e}=this.props;return e&&!this.hasError()&&e.total>0}hasError(){return!1===this.props.siteIsConnected}showIndicator(){const{siteIsAutomatedTransfer:e,siteIsJetpack:t,userCanManage:s}=this.props;return s&&t&&!e&&(this.hasUpdate()||this.hasError())}updatesAvailable(){const{site:e,siteUpdates:t,translate:s}=this.props,i="/activity-log/"+e.slug;return t.wordpress===t.total&&e.canUpdateFiles?d.createElement("span",null,s("A newer version of WordPress is available. {{link}}Update to %(version)s{{/link}}",{components:{link:d.createElement("a",{href:i,onClick:this.handleCoreUpdate})},args:{version:t.wp_update_version}})):t.plugins===t.total&&e.canUpdateFiles?d.createElement("span",null,d.createElement("a",{onClick:this.handlePluginsUpdate,href:i},s("There is a plugin update available.","There are plugin updates available.",{count:t.total}))):t.themes===t.total&&e.canUpdateFiles?d.createElement("span",null,d.createElement("a",{onClick:this.handleThemesUpdate,href:i},s("There is a theme update available.","There are theme updates available.",{count:t.total}))):t.themes+t.plugins+t.wordpress===t.total&&e.canUpdateFiles?d.createElement("span",null,d.createElement("a",{onClick:this.handleMultipleUpdate,href:i},s("There are updates available."))):d.createElement("span",null,d.createElement(w,{onClick:this.handleGenericUpdate,href:e.options.admin_url+"update-core.php"},s("There is an update available.","There are updates available.",{count:t.total})))}recordEvent(e,t){window.scrollTo(0,0),this.setState({expand:!1}),this.props.recordGoogleEvent("Site-Indicator",e,"Total Updates",t)}errorAccessing(){const{site:e,translate:t}=this.props;return e?d.createElement("span",null,t("This site cannot be accessed."),d.createElement(_.Z,{borderless:!0,compact:!0,scary:!0,href:`/settings/disconnect-site/${e.slug}?type=down`,onClick:this.props.trackSiteDisconnect},t("Iâ€™d like to fix this now"))):d.createElement("span",null,t("This site cannot be accessed."))}getText(){return this.hasUpdate()?this.updatesAvailable():this.hasError()?this.errorAccessing():null}getIcon(){return this.hasUpdate()?"sync":this.hasError()?"notice":void 0}renderIndicator(){const e=r()({"is-expanded":this.state.expand,"is-update":this.hasUpdate(),"is-error":this.hasError(),"is-action":!0,"site-indicator__main":!0});return d.createElement("div",{className:e},!this.state.expand&&d.createElement(g.Z,{type:"appear"},d.createElement("button",{className:"site-indicator__button",onClick:this.toggleExpand},d.createElement(a.Z,{icon:this.getIcon(),size:16}))),this.state.expand&&d.createElement("div",{className:"site-indicator__message"},d.createElement("div",{className:"site-indicator__action"},this.getText()),d.createElement("button",{className:"site-indicator__button",onClick:this.toggleExpand},d.createElement(g.Z,{type:"appear"},d.createElement(a.Z,{icon:"cross",size:18})))))}render(){const{site:e,siteIsJetpack:t}=this.props;return d.createElement("div",{className:"site-indicator__wrapper"},t&&d.createElement(v.Z,{siteId:e.ID}),this.showIndicator()&&this.renderIndicator())}}const S=(0,h.$j)(((e,{site:t})=>({siteIsConnected:t&&(0,j.Z)(e,t.ID),siteIsJetpack:t&&(0,f.Z)(e,t.ID),siteIsAutomatedTransfer:t&&(0,Z.Z)(e,t.ID),siteUpdates:t&&I(e,t.ID),userCanManage:t&&(0,b.i)(e,t.ID,"manage_options")})),{recordGoogleEvent:E.yt,recordTracksEvent:E.jN,trackSiteDisconnect:()=>(0,x.N)((0,E.yt)("Jetpack","Clicked in site indicator to start Jetpack Disconnect flow"),(0,E.jN)("calypso_jetpack_site_indicator_disconnect_start"))})((0,c.NC)(C));var U=s("./state/selectors/is-nav-unification-enabled.js"),N=s("./state/selectors/is-unlaunched-site.js"),T=s("./state/sites/selectors/get-site.js"),D=s("./state/sites/selectors/is-site-previewable.js"),M=s("./state/sites/selectors/get-site-slug.js");const L=()=>{};class P extends d.Component{constructor(...e){super(...e),(0,i.Z)(this,"onSelect",(e=>{this.props.onSelect(e,this.props.site.ID)})),(0,i.Z)(this,"onMouseEnter",(e=>{this.props.onMouseEnter(e,this.props.site.ID)})),(0,i.Z)(this,"onMouseLeave",(e=>{this.props.onMouseLeave(e,this.props.site.ID)})),(0,i.Z)(this,"onViewSiteClick",(e=>{const{isPreviewable:t,siteSlug:s}=this.props;return t?e.altKey||e.ctrlKey||e.metaKey||e.shiftKey?(this.props.recordTracksEvent("calypso_mysites_sidebar_view_site_modifier_clicked"),void this.props.recordGoogleEvent("Sidebar","Clicked View Site | Modifier Key")):(e.preventDefault(),this.props.recordTracksEvent("calypso_mysites_sidebar_view_site_clicked"),this.props.recordGoogleEvent("Sidebar","Clicked View Site | Calypso"),void p()("/view/"+s)):(this.props.recordTracksEvent("calypso_mysites_sidebar_view_site_unpreviewable_clicked"),void this.props.recordGoogleEvent("Sidebar","Clicked View Site | Unpreviewable"))}))}render(){const{isSiteUnlaunched:e,site:t,translate:s}=this.props;if(!t)return null;const i=r()({site:!0,"is-jetpack":t.jetpack,"is-primary":t.primary,"is-private":t.is_private,"is-redirect":t.options&&t.options.is_redirect,"is-selected":this.props.isSelected,"is-highlighted":this.props.isHighlighted,"is-compact":this.props.compact}),o=!t.is_private&&this.props.site.is_coming_soon,c=t.is_private&&e,l=this.props.site.is_coming_soon||c;return d.createElement("div",{className:i},d.createElement("a",{className:"site__content",href:this.props.homeLink?t.URL:this.props.href,"data-tip-target":this.props.tipTarget,target:this.props.externalLink&&"_blank",title:this.props.homeLink?s("View %(domain)s",{args:{domain:t.domain}}):t.domain,onClick:this.props.homeLink?this.onViewSiteClick:this.onSelect,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,"aria-label":this.props.homeLink?s("View %(domain)s",{args:{domain:t.domain}}):t.domain},d.createElement(u.Z,{site:t,size:this.props.compact?24:32}),d.createElement("div",{className:"site__info"},d.createElement("div",{className:"site__title"},t.title),d.createElement("div",{className:"site__domain"},this.props.isNavUnificationEnabled&&!(0,n._k)("jetpack-cloud")?t.domain:this.props.homeLink?s("View %(domain)s",{args:{domain:t.domain}}):t.domain),this.props.site.is_private&&d.createElement("span",{className:"site__badge site__badge-private"},s(l?"Coming Soon":"Private")),o&&d.createElement("span",{className:"site__badge site__badge-coming-soon"},s("Coming Soon")),t.options&&t.options.is_redirect&&d.createElement("span",{className:"site__badge site__badge-redirect"},s("Redirect")),t.options&&t.options.is_domain_only&&d.createElement("span",{className:"site__badge site__badge-domain-only"},s("Domain"))),this.props.homeLink&&this.props.showHomeIcon&&d.createElement("span",{className:"site__home"},d.createElement(a.Z,{icon:"house",size:18}))),this.props.indicator&&(0,n._k)("site-indicator")?d.createElement(S,{site:t}):null)}}(0,i.Z)(P,"defaultProps",{onSelect:L,onMouseEnter:L,onMouseLeave:L,href:null,indicator:!0,isSelected:!1,homeLink:!1,showHomeIcon:!0,compact:!1});const q=(0,h.$j)((function(e,t){const s=t.siteId||t.site.ID;return{siteId:s,site:s?(0,T.Z)(e,s):t.site,isPreviewable:(0,D.Z)(e,s),siteSlug:(0,M.Z)(e,s),isSiteUnlaunched:(0,N.Z)(e,s),isNavUnificationEnabled:(0,U.Z)(e)}}),{recordGoogleEvent:E.yt,recordTracksEvent:E.jN})((0,c.NC)(P))},"./components/animate/index.jsx":(e,t,s)=>{s.d(t,{Z:()=>n});s("../node_modules/prop-types/index.js");var i=s("../node_modules/react/index.js");const n=({type:e,children:t})=>i.createElement("div",{className:`animate__${e}`},t)},"./components/data/query-site-connection-status/index.jsx":(e,t,s)=>{s.d(t,{Z:()=>p});s("../node_modules/prop-types/index.js");var i=s("../node_modules/react/index.js"),n=s("../node_modules/react-redux/es/index.js"),a=s("../node_modules/lodash-es/get.js");function o(e,t){return(0,a.Z)(e.sites.connection.requesting,t,!1)}var r=s("./lib/wp/browser.js"),c=s("./state/action-types.ts");class l extends i.Component{UNSAFE_componentWillMount(){this.request(this.props)}UNSAFE_componentWillReceiveProps(e){this.props.siteId!==e.siteId&&this.request(e)}request(e){!e.requestingSiteConnectionStatus&&e.siteId&&e.requestConnectionStatus(e.siteId)}render(){return null}}const p=(0,n.$j)(((e,t)=>({requestingSiteConnectionStatus:o(e,t.siteId)})),{requestConnectionStatus:e=>t=>(t({type:c.U5d,siteId:e}),r.Z.undocumented().testConnectionJetpack(e).then((s=>{t({type:c.tvw,siteId:e,status:s.connected}),t({type:c.D5g,siteId:e})})).catch((s=>{t({type:c.QLz,siteId:e,error:s})})))})(l)},"./components/external-link/index.jsx":(e,t,s)=>{s.d(t,{Z:()=>u});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("../packages/components/src/gridicon/index.tsx"),a=s("../packages/components/src/screen-reader-text/index.js"),o=s("../node_modules/classnames/index.js"),r=s.n(o),c=s("../packages/i18n-calypso/src/index.js"),l=s("../node_modules/lodash-es/omit.js"),p=(s("../node_modules/prop-types/index.js"),s("../node_modules/react/index.js")),d=s("./lib/i18n-utils/browser.js");class h extends p.Component{render(){const e=r()("external-link",this.props.className,{"icon-first":this.props.showIconFirst,"has-icon":this.props.icon}),t={...(0,l.Z)(this.props,"icon","iconSize","showIconFirst","iconClassName"),className:e,rel:"external"};this.props.icon&&(t.target="_blank"),t.target&&(t.rel=t.rel.concat(" noopener noreferrer")),t.href&&(t.href=(0,d.aq)(t.href));const s=p.createElement(n.Z,{className:this.props.iconClassName,icon:"external",size:this.props.iconSize});return p.createElement("a",t,this.props.icon&&this.props.showIconFirst&&s,this.props.children,this.props.icon&&!this.props.showIconFirst&&s,this.props.icon&&p.createElement(a.Z,null,(0,c.Iu)("(opens in a new tab)",{comment:"accessibility label for an external link"})))}}(0,i.Z)(h,"defaultProps",{iconSize:18,showIconFirst:!1});const u=h},"./state/selectors/get-onboarding-url.js":(e,t,s)=>{s.d(t,{Z:()=>r});var i=s("../packages/calypso-config/src/index.ts"),n=s("./lib/jetpack/is-jetpack-cloud.ts"),a=s("./state/current-user/selectors.js");const o=["en","en-gb"];function r(e){if((0,n.Z)())return(0,i.ZP)("jetpack_connect_url");const t=(0,a.Mg)(e);return o.includes(t)?(0,i.ZP)("gutenboarding_url"):(0,i.ZP)("signup_url")}},"./state/selectors/get-site-connection-status.js":(e,t,s)=>{s.d(t,{Z:()=>n});var i=s("../node_modules/lodash-es/get.js");function n(e,t){return(0,i.Z)(e.sites.connection.items,t,null)}},"./state/selectors/get-sites.js":(e,t,s)=>{s.d(t,{Z:()=>l});var i=s("../packages/state-utils/src/index.ts"),n=s("../node_modules/lodash-es/sortBy.js"),a=s("../node_modules/lodash-es/partition.js"),o=s("./state/selectors/get-primary-site-id.js"),r=s("./state/selectors/get-sites-items.js"),c=s("./state/sites/selectors/get-site.js");const l=(0,i.P1)((e=>{const t=(0,o.Z)(e),[s,i]=(0,a.Z)((0,r.Z)(e),{ID:t});return[...s,...(l=i,(0,n.Z)(l,["name","URL"]))].map((t=>(0,c.Z)(e,t.ID)));var l}),(e=>[(0,r.Z)(e),e.currentUser.capabilities]))},"./state/sites/selectors/is-site-previewable.js":(e,t,s)=>{s.d(t,{Z:()=>o});var i=s("./sections-filter.js"),n=s("./state/selectors/get-raw-site.js"),a=s("./state/sites/selectors/get-site-option.js");function o(e,t){const s=(0,n.Z)(e,t);if(!s)return null;if(s.is_vip)return!1;if(!(0,i.e)("preview"))return!1;if((0,a.Z)(e,t,"is_wpforteams_site"))return!1;const o=(0,a.Z)(e,t,"unmapped_url");return!!o&&(!!(r=o)&&r.startsWith("https://"));var r}},"../packages/components/src/screen-reader-text/index.js":(e,t,s)=>{s.d(t,{Z:()=>n});var i=s("../node_modules/react/index.js");function n({children:e}){return i.createElement("span",{className:"screen-reader-text"},e)}}}]);