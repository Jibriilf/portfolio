"use strict";(globalThis.webpackChunkcalypso=globalThis.webpackChunkcalypso||[]).push([[80489],{"./gutenberg/editor/index.js":(e,t,s)=>{s.r(t),s.d(t,{default:()=>ze});var i=s("../node_modules/page/page.js"),o=s.n(i),r=s("./controller/index.web.js"),a=s("./my-sites/controller.js"),n=s("../packages/calypso-config/src/index.ts"),d=s("../node_modules/lodash-es/get.js"),l=s("../node_modules/lodash-es/has.js"),c=s("../node_modules/react/index.js"),p=s("./lib/url/add-query-args.ts"),u=s("./state/action-types.ts"),m=s("./state/admin-menu/actions/index.js"),h=s("./state/admin-menu/selectors/index.js"),g=s("./state/editor/actions.js"),f=s("./state/selected-editor/actions.js"),y=s("./state/selectors/get-editor-url.js"),I=s("./state/selectors/get-selected-editor.js"),w=s("./state/selectors/get-site-editor-url.js"),P=s("./state/selectors/is-site-automated-transfer.js"),Z=s("./state/selectors/is-site-using-core-site-editor.js"),j=s("./state/selectors/should-load-gutenframe.js"),b=s("./state/sites/actions.js"),_=s("./state/sites/selectors/get-site-option.js"),v=s("./state/sites/selectors/is-jetpack-site.js"),E=s("./state/selectors/get-raw-site.js");function k(e,t){const s=(0,E.Z)(e,t);return s?s?.options?.active_modules?.includes("sso"):null}var T=s("./state/sites/selectors/get-site-url.js"),S=s("./state/ui/selectors/get-selected-site-id.js"),M=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),C=s("../node_modules/url/url.js"),x=s("../node_modules/@wordpress/url/build-module/get-query-arg.js"),R=s("../packages/i18n-calypso/src/index.js"),$=s("../node_modules/lodash-es/map.js"),q=s("../node_modules/lodash-es/pickBy.js"),U=s("../node_modules/lodash-es/flowRight.js"),L=s("../node_modules/react-redux/es/index.js"),N=s("./components/async-load/index.jsx"),O=s("./components/web-preview/index.jsx"),D=s("./lib/analytics/page-view-tracker/index.jsx"),B=s("./lib/navigate/index.ts"),V=s("./lib/performance-tracking/index.web.ts"),A=s("./lib/protect-form/index.tsx"),G=s("./lib/wp/browser.js"),z=(s("../node_modules/prop-types/index.js"),s("./components/data/document-head/index.jsx")),F=s("./components/data/query-post-types/index.jsx"),W=s("./state/editor/selectors.js"),Y=s("./state/post-types/selectors.js"),H=s("./state/posts/selectors/get-edited-post-value.js");const Q=(0,L.$j)((e=>{const t=(0,S.Z)(e),s=(0,W.BN)(e),i=(0,H.r)(e,t,s,"type");return{siteId:t,type:i,typeObject:(0,Y.z_)(e,t,i),newPost:(0,W.To)(e)}}))((0,R.NC)((function({translate:e,siteId:t,type:s,typeObject:i,newPost:o}){let r;return r="post"===s?e(o?"New Post":"Edit Post",{textOnly:!0}):"page"===s?e(o?"New Page":"Edit Page",{textOnly:!0}):o?i?i.labels.new_item:e("New",{textOnly:!0}):i?i.labels.edit_item:e("Edit",{context:"verb",textOnly:!0}),c.createElement("div",null,t&&"page"!==s&&"post"!==s&&c.createElement(F.Z,{siteId:t}),c.createElement(z.Z,{title:r}))})));var X=s("./state/media/actions.js"),J=s("../node_modules/debug/src/browser.js");const K=s.n(J)()("calypso:media");var ee=s("./state/media/thunks/get-media-item.js"),te=s("./state/posts/actions/edit-post.js"),se=s("./state/posts/actions/trash-post.js"),ie=s("./state/posts/revisions/actions.js"),oe=s("./state/route/actions.js"),re=s("./state/selectors/get-current-route.js");const ae=e=>e?.route?.lastNonEditorRoute||"";var ne=s("./state/sites/selectors/get-site-slug.js"),de=s("./state/sites/selectors/is-single-user-site.js");const le=(e,t)=>{const s=(0,S.Z)(e),i=(0,ne.Z)(e,s),o=(0,v.Z)(e,s),r=(0,de.Z)(e,s),a=(0,d.Z)({page:"pages",post:"posts"},t,`types/${t}`);return"post"!==t||o||r?`/${a}/${i}`:`/${a}/my/${i}`};const ce=(e,t)=>{const s=(0,S.Z)(e),i=(0,ne.Z)(e,s),o=(0,v.Z)(e,s),r=(0,de.Z)(e,s),a=(0,d.Z)({page:"pages",post:"posts"},t,`types/${t}`);return"post"!==t||o||r?`/${a}/trashed/${i}`:`/${a}/my/trashed/${i}`};var pe=s("./state/selectors/get-site-url.js"),ue=s("./state/selectors/is-site-wpforteams.js"),me=s("./state/selectors/is-unlaunched-site.js"),he=s("./state/sites/selectors/get-site-admin-url.js"),ge=s("./state/sites/selectors/is-requesting-site.js"),fe=s("./state/sites/selectors/get-customizer-url.js"),ye=s("./state/sites/selectors/get-site.js"),Ie=s("./state/ui/selectors/get-selected-site-slug.js"),we=s("../node_modules/@babel/runtime/helpers/esm/extends.js");const Pe=(0,c.forwardRef)((function(e,t){return(0,c.useEffect)((()=>{window.performance?.mark?.("iframe_rendered")}),[e.src]),c.createElement("iframe",(0,we.default)({},e,{ref:t}))}));var Ze=s("../node_modules/@wordpress/blocks/build-module/index.js"),je=s("../node_modules/lodash-es/reduce.js"),be=s("../node_modules/lodash-es/includes.js");const _e=e=>!e||Array.isArray(e)&&!e.length||(0,be.Z)(e,"image")?[]:["google_photos","pexels"],ve={image:"images",audio:"audio",video:"videos"},Ee=e=>Array.isArray(e)&&e.length?e.map((e=>ve[e])):void 0,ke=()=>c.createElement("div",{className:"editor__placeholder"},c.createElement("div",{className:"edit-post-layout"},c.createElement("div",{className:"edit-post-header"},c.createElement("div",{className:"edit-post-header-toolbar"},c.createElement("div",{className:"placeholder placeholder-site"},"Placeholder")),c.createElement("div",{className:"edit-post-header__settings"},c.createElement("div",{className:"placeholder placeholder-button"},"Placeholder"),c.createElement("div",{className:"placeholder placeholder-button"},"Placeholder"),c.createElement("div",{className:"placeholder placeholder-button"},"Placeholder"))),c.createElement("div",{className:"edit-post-layout__content"},c.createElement("div",{className:"edit-post-visual-editor editor-styles-wrapper"},c.createElement("div",{className:"editor-writing-flow"},c.createElement("div",{className:"editor-post-title"},c.createElement("div",{className:"placeholder placeholder-title wp-block editor-post-title__block"},"Placeholder")))))));var Te,Se;!function(e){e.Loaded="loaded",e.ClassicBlockOpenMediaModel="classicBlockOpenMediaModal"}(Te||(Te={})),function(e){e.GoToAllPosts="goToAllPosts",e.CloseEditor="closeEditor",e.OpenMediaModal="openMediaModal",e.OpenCheckoutModal="openCheckoutModal",e.GetCheckoutModalStatus="getCheckoutModalStatus",e.OpenRevisions="openRevisions",e.PostStatusChange="postStatusChange",e.PreviewPost="previewPost",e.ViewPost="viewPost",e.SetDraftId="draftIdSet",e.TrashPost="trashPost",e.OpenCustomizer="openCustomizer",e.GetTemplateEditorUrl="getTemplateEditorUrl",e.OpenTemplatePart="openTemplatePart",e.GetCloseButtonUrl="getCloseButtonUrl",e.GetGutenboardingStatus="getGutenboardingStatus",e.ToggleInlineHelpButton="toggleInlineHelpButton",e.GetNavSidebarLabels="getNavSidebarLabels",e.GetCalypsoUrlInfo="getCalypsoUrlInfo",e.TrackPerformance="trackPerformance"}(Se||(Se={}));var Me=function(e){Promise.all([s.e(33832),s.e(16081),s.e(74004),s.e(9228),s.e(42160),s.e(32323),s.e(14059),s.e(38243),s.e(31562),s.e(72407),s.e(75613),s.e(81653),s.e(14953),s.e(2389),s.e(37803),s.e(83309),s.e(10175),s.e(14890),s.e(74456),s.e(34738),s.e(24990),s.e(80987),s.e(90103),s.e(42409),s.e(22702)]).then(s.bind(s,"./post-editor/editor-media-modal/index.jsx")).then((function(t){e(t.default)}))},Ce=function(e){Promise.all([s.e(33832),s.e(16081),s.e(74004),s.e(10773),s.e(53527),s.e(28509),s.e(42357),s.e(97429),s.e(6994),s.e(16419),s.e(99340),s.e(22777),s.e(75534),s.e(1094),s.e(81405),s.e(38186),s.e(94615)]).then(s.bind(s,"./blocks/editor-checkout-modal/index.tsx")).then((function(t){e(t.default)}))},xe=function(e){s.e(78845).then(s.bind(s,"./post-editor/editor-revisions/dialog.jsx")).then((function(t){e(t.default)}))};class Re extends c.Component{constructor(...e){super(...e),(0,M.Z)(this,"state",{isMediaModalVisible:!1,isCheckoutModalVisible:!1,isIframeLoaded:!1,isPreviewVisible:!1,previewUrl:"about:blank",currentIFrameUrl:"",checkoutModalOptions:void 0}),(0,M.Z)(this,"iframeRef",c.createRef()),(0,M.Z)(this,"iframePort",null),(0,M.Z)(this,"mediaSelectPort",null),(0,M.Z)(this,"mediaCancelPort",null),(0,M.Z)(this,"revisionsPort",null),(0,M.Z)(this,"checkoutPort",null),(0,M.Z)(this,"editorRedirectTimer",void 0),(0,M.Z)(this,"setEditorRedirectTimer",(e=>{this.editorRedirectTimer&&clearTimeout(this.editorRedirectTimer),this.editorRedirectTimer=setTimeout(this.tryRedirect,e)})),(0,M.Z)(this,"disableRedirects",!1),(0,M.Z)(this,"tryRedirect",(()=>{this.disableRedirects||window.location.replace(this.props.iframeUrl)})),(0,M.Z)(this,"onMessage",(({data:e,origin:t})=>{if(!e||"gutenbergIframeMessage"!==e.type)return;if(!(this.props.siteAdminUrl&&0===this.props.siteAdminUrl.indexOf(t)))return;const{action:s}=e;if(Te.Loaded===s&&this.iframeRef.current&&this.iframeRef.current.contentWindow){this.disableRedirects=!0,this.editorRedirectTimer&&clearTimeout(this.editorRedirectTimer);const{port1:e,port2:t}=new window.MessageChannel;return this.iframePort=e,this.iframePort.addEventListener("message",this.onIframePortMessage,!1),this.iframePort.start(),this.iframeRef.current.contentWindow.postMessage({action:"initPort"},"*",[t]),this.pressThis(),this.props.setEditorIframeLoaded(!0,this.iframePort),window.performance?.mark?.("iframe_loaded"),void this.setState({isIframeLoaded:!0,currentIFrameUrl:this.props.iframeUrl})}if(Te.ClassicBlockOpenMediaModel===s){if(e.imageId){const{siteId:t}=this.props;this.props.selectMediaItems(t,[{ID:e.imageId}])}this.setState({classicBlockEditorId:e.editorId,isMediaModalVisible:!0,multiple:!0})}})),(0,M.Z)(this,"onIframePortMessage",(e=>{const{data:t,ports:s}=e,i=t.ports??s,{action:r,payload:a}=t;if(Se.OpenMediaModal===r&&i&&i[0]){const{siteId:e}=this.props,{allowedTypes:t,gallery:s,multiple:o,value:r}=a;if(this.mediaSelectPort=i[0],this.mediaCancelPort=i[1],r){const t=(Array.isArray(r)?r.map((e=>parseInt(e,10))):[parseInt(r,10)]).map((t=>{const s=this.props.getMediaItem(e,t);return s||this.props.fetchMediaItem(e,t),{ID:t,...s}}));this.props.selectMediaItems(e,t)}else this.props.selectMediaItems(e,[]);this.setState({isMediaModalVisible:!0,allowedTypes:t,gallery:s,multiple:o})}if(Se.OpenCheckoutModal===r&&(this.checkoutPort=i[0],this.setState({isCheckoutModalVisible:!0,checkoutModalOptions:a})),Se.GetCheckoutModalStatus===r){const e=n.ZP.isEnabled("post-editor/checkout-overlay");i[0].postMessage({isCheckoutOverlayEnabled:e})}if(Se.SetDraftId===r&&!this.props.postId){const{postId:e}=a,{siteId:t,currentRoute:s,postType:i}=this.props;s.endsWith(`/${e}`)||(o().replace(`${s}/${e}`,null,!1,!1),this.props.setRoute(`${s}/${e}`),this.props.startEditingPost(t,e),this.props.editPost(t,e,{type:i}))}if(Se.TrashPost===r){const{siteId:e,editedPostId:t,postTypeTrashUrl:s}=this.props;this.props.trashPost(e,t),(0,B.c)(s)}if(Se.CloseEditor===r||Se.GoToAllPosts===r){const{unsavedChanges:e=!1}=a;this.props.setEditorIframeLoaded(!1),this.navigate(this.props.closeUrl,e)}if(Se.OpenRevisions===r&&(i&&i[0]&&(this.revisionsPort=i[0]),this.props.openPostRevisionsDialog()),Se.PreviewPost===r){const{postUrl:e}=a;this.openPreviewModal(e,i[0])}if(Se.ViewPost===r){const{postUrl:e}=a;window.open(e,"_top")}if(Se.OpenCustomizer===r){const{autofocus:e=null,unsavedChanges:t=!1}=a;this.openCustomizer(e,t)}if(Se.OpenTemplatePart===r){const{templatePartId:e,unsavedChanges:t}=a;if(new RegExp(`\\/edit\\/wp_template_part\\/.+\\/${e}\\?`,"i").test(window.location.href))return;const s=this.getTemplateEditorUrl(e);this.navigate(s,t)}if(Se.GetCloseButtonUrl===r){const{closeUrl:e,closeLabel:t}=this.props;i[0].postMessage({closeUrl:`${window.location.origin}${e}`,label:t})}if(Se.GetGutenboardingStatus===r){const e="gutenboarding"===this.props.siteCreationFlow,t=window.location.href;i[0].postMessage({isGutenboarding:e,currentCalypsoUrl:t})}if(Se.ToggleInlineHelpButton===r){const e=window.top.document.querySelector("#wpcom > .layout > .inline-help");e&&(e.hidden=a.hidden)}if(Se.GetNavSidebarLabels===r){const{translate:e}=this.props;i[0].postMessage({allPostsLabels:{page:e("View all pages"),post:e("View all posts")},createPostLabels:{page:e("Add new page"),post:e("Add new post")},listHeadings:{page:e("Recent Pages"),post:e("Recent Posts")}})}if(Se.GetCalypsoUrlInfo===r&&i[0].postMessage({origin:window.location.origin,siteSlug:this.props.siteSlug}),Se.PostStatusChange===r){const{status:e}=a;this.handlePostStatusChange(e)}Se.TrackPerformance===r&&"editor.ready"===a.mark&&this.props.stopPerformanceTracking({isNew:a.isNew,blockCount:a.blockCount})})),(0,M.Z)(this,"handlePostStatusChange",(e=>{const{creatingNewHomepage:t,editedPostId:s,isSiteWPForTeams:i,siteUrl:o}=this.props;t&&"publish"===e&&this.setFrontPage(),i&&s&&o&&"publish"===e&&(top.location.href=(0,p.Z)({p:s},o))})),(0,M.Z)(this,"setFrontPage",(()=>{const{editedPostId:e,siteId:t}=this.props;this.props.updateSiteFrontPage(t,{show_on_front:"page",page_on_front:e})})),(0,M.Z)(this,"loadRevision",(({post_title:e,post_excerpt:t,post_content:s})=>{this.iframePort&&(this.revisionsPort?(this.revisionsPort.postMessage({title:e,excerpt:t,content:s}),this.revisionsPort.close(),this.revisionsPort=null):this.iframePort.postMessage({action:"loadRevision",payload:{title:e,excerpt:t,content:s}}))})),(0,M.Z)(this,"closeMediaModal",(e=>{if(!this.state.classicBlockEditorId&&e&&this.mediaSelectPort){const{multiple:t}=this.state,s=(0,$.Z)(e.items,(e=>(e=>({id:(0,d.Z)(e,"ID"),url:(0,d.Z)(e,"URL"),alt:(0,d.Z)(e,"alt"),caption:e.caption?(0,Ze.eP)(e.caption,{source:"children"}):"",description:(0,d.Z)(e,"description"),filename:(0,d.Z)(e,"file"),height:(0,d.Z)(e,"height"),icon:(0,d.Z)(e,"icon"),mime:(0,d.Z)(e,"mime_type"),sizes:{full:{url:(0,d.Z)(e,"URL")},...(0,je.Z)(e.thumbnails,((e,t,s)=>(e[s]={url:t},e)),{})},title:(0,d.Z)(e,"title"),type:(0,d.Z)(e,"mime_type","").split("/")[0],width:(0,d.Z)(e,"width")}))(e))),i=t?s:s[0];this.mediaSelectPort.postMessage(i),this.mediaSelectPort.close(),this.mediaSelectPort=null}this.state.classicBlockEditorId||e||!this.mediaCancelPort||(this.mediaCancelPort.postMessage(!0),this.mediaCancelPort.close(),this.mediaCancelPort=null),this.setState({classicBlockEditorId:null,isMediaModalVisible:!1})})),(0,M.Z)(this,"insertClassicBlockMedia",(e=>{this.state.classicBlockEditorId&&this.iframePort&&this.iframePort.postMessage({action:"insertClassicBlockMedia",payload:{editorId:this.state.classicBlockEditorId,media:e}})})),(0,M.Z)(this,"closeCheckoutModal",(()=>{this.setState({isCheckoutModalVisible:!1})})),(0,M.Z)(this,"pressThis",(()=>{const{pressThis:e}=this.props;e&&this.iframePort&&this.iframePort.postMessage({action:"pressThis",payload:e})})),(0,M.Z)(this,"openPreviewModal",((e,t)=>{this.setState({isPreviewVisible:!0,previewUrl:"about:blank",postUrl:e}),t.onmessage=e=>{t.close();const{frameNonce:s,unmappedSiteUrl:i}=this.props,{previewUrl:o,editedPost:r}=e.data,a=C.parse(o,!0);s&&(a.query["frame-nonce"]=s),a.query.iframe="true",delete a.search;const{host:n}=C.parse(i);n&&(a.host=n,a.hostname=n),this.setState({previewUrl:C.format(a),editedPost:r})}})),(0,M.Z)(this,"closePreviewModal",(()=>this.setState({isPreviewVisible:!1}))),(0,M.Z)(this,"openCustomizer",((e,t)=>{let{customizerUrl:s}=this.props;if(e){const[t,i]=Object.entries(e)[0];s=(0,p.Z)({[`autofocus[${t}]`]:i},s)}this.navigate(s,t)})),(0,M.Z)(this,"getTemplateEditorUrl",(e=>{const{getTemplateEditorUrl:t,editedPostId:s}=this.props;let i=t(e);return s&&(i=(0,p.Z)({fse_parent_post:s},i)),i})),(0,M.Z)(this,"navigate",((e,t)=>{const{markChanged:s,markSaved:i}=this.props;t?s():i(),(0,B.c)(e)})),(0,M.Z)(this,"getStatsPath",(()=>{const{postId:e}=this.props;return e?"/:post_type/:site/:post_id":"/:post_type/:site"})),(0,M.Z)(this,"getStatsProps",(()=>{const{postId:e,postType:t}=this.props;return e?{post_type:t,post_id:e}:{post_type:t}})),(0,M.Z)(this,"getStatsTitle",(()=>{const{postId:e,postType:t}=this.props;let s;switch(t){case"post":s="Post";break;case"page":s="Page";break;default:s="Custom Post Type"}return e?`Block Editor > ${s} > Edit`:`Block Editor > ${s} > New`})),(0,M.Z)(this,"handleCheckoutSuccess",(()=>{this.checkoutPort&&(this.checkoutPort.postMessage("checkout complete"),this.checkoutPort.close(),this.checkoutPort=null,this.setState({isCheckoutModalVisible:!1}))}))}componentDidMount(){window.addEventListener("message",this.onMessage,!1),this.props.shouldLoadIframe&&!this.editorRedirectTimer&&this.setEditorRedirectTimer(25e3),window.sessionStorage.getItem("a8c-clearLastNonEditorRoute")&&(window.sessionStorage.removeItem("a8c-clearLastNonEditorRoute"),this.props.clearLastNonEditorRoute())}componentDidUpdate({shouldLoadIframe:e}){this.editorRedirectTimer||e||!this.props.shouldLoadIframe||this.setEditorRedirectTimer(25e3)}componentWillUnmount(){this.editorRedirectTimer&&clearTimeout(this.editorRedirectTimer),window.removeEventListener("message",this.onMessage,!1)}render(){const{iframeUrl:e,shouldLoadIframe:t}=this.props,{classicBlockEditorId:s,isMediaModalVisible:i,isCheckoutModalVisible:o,allowedTypes:r,multiple:a,isIframeLoaded:d,isPreviewVisible:l,previewUrl:p,postUrl:u,editedPost:m,currentIFrameUrl:h,checkoutModalOptions:g}=this.state,f=!!s,y=n.ZP.isEnabled("post-editor/checkout-overlay"),{redirectTo:I,isFocusedLaunch:w,...P}=g||{};return c.createElement(c.Fragment,null,c.createElement(D.Z,{path:this.getStatsPath(),title:this.getStatsTitle(),properties:this.getStatsProps()}),c.createElement(Q,null),c.createElement("div",{className:"main main-column calypsoify is-iframe",role:"main"},!d&&c.createElement(ke,null),(t||d)&&c.createElement(Pe,{className:d?"is-loaded":"",ref:this.iframeRef,src:d?h:e,onLoad:()=>this.setEditorRedirectTimer(2e3),style:d?void 0:{opacity:0}})),c.createElement(N.Z,{require:Me,placeholder:null,disabledDataSources:_e(r),enabledFilters:Ee(r),galleryViewEnabled:f,isGutenberg:!f,onClose:this.closeMediaModal,onInsertMedia:this.insertClassicBlockMedia,single:!a,source:"",visible:i}),y&&c.createElement(N.Z,{checkoutOnSuccessCallback:this.handleCheckoutSuccess,require:Ce,onClose:this.closeCheckoutModal,placeholder:null,isOpen:o,cartData:P,redirectTo:I,isFocusedLaunch:w}),c.createElement(N.Z,{require:xe,placeholder:null,loadRevision:this.loadRevision}),c.createElement(O.Z,{externalUrl:u,onClose:this.closePreviewModal,overridePost:m,previewUrl:p,showEditHeaderLink:!0,showPreview:l}))}}const $e={setRoute:oe.p,openPostRevisionsDialog:ie.VH,setEditorIframeLoaded:g.jP,startEditingPost:g.jZ,editPost:te.d,trashPost:se.W,updateSiteFrontPage:b.p$,selectMediaItems:X.Un,fetchMediaItem:(e,t)=>s=>{K("Fetching media for %d using ID %d",e,t),s((0,X.lh)(e,t))},getMediaItem:ee.Z,clearLastNonEditorRoute:oe.Y},qe=(0,U.Z)(V.ZW,(0,L.$j)(((e,{postId:t,postType:s,duplicatePostId:i,fseParentPageId:o,parentPostId:r,creatingNewHomepage:a,editorType:d="post",stripeConnectSuccess:l,anchorFmData:c})=>{const u=(0,S.Z)(e),m=(0,Ie.Z)(e),h=(0,re.Z)(e),g=ce(e,s),f=(0,v.Z)(e,u)?"jetpack_frame_nonce":"frame_nonce";let w=(0,q.Z)({post:t,action:t&&"edit",post_type:"post"!==s&&s,calypsoify:1,fse_parent_post:null!=o&&o,parent_post:null!=r&&r,"block-editor":1,"frame-nonce":(0,_.Z)(e,u,f)||"","jetpack-copy":i,origin:window.location.origin,"environment-id":(0,n.ZP)("env_id"),"new-homepage":a,...!!l&&{stripe_connect_success:l},...c,openSidebar:(0,x.I)(window.location.href,"openSidebar")});G.Z.addSupportParams&&(w=G.Z.addSupportParams(w)),"classic"===(0,I.E)(e,u)&&(w["in-editor-deprecation-group"]=1);const P="site"===d?(0,he.Z)(e,u,"admin.php?page=gutenberg-edit-site"):(0,he.Z)(e,u,t?"post.php":"post-new.php"),Z=(0,p.Z)(w,P),j=!(0,ge.Z)(e,u),{url:b,label:E}=function(e,t,s,i){if("wp_template_part"===s&&i)return{url:(0,y.Z)(e,t,i,"page")};const o=ae(e),r=e=>o.match(e);if(r(/^\/themes\/?/))return{url:`/themes/${(0,ne.Z)(e,t)}`,label:(0,R.Iu)("Themes")};if(!o||!s||r(/^\/home\/?/))return{url:`/home/${(0,ne.Z)(e,t)}`,label:(0,R.Iu)("Dashboard")};let a=(0,R.Iu)("Back");return"post"===s?a=(0,R.Iu)("View Posts"):"page"===s&&(a=(0,R.Iu)("View Pages")),{url:le(e,s),label:a}}(e,u,s,o);return{closeUrl:b,closeLabel:E,currentRoute:h,editedPostId:(0,W.BN)(e),frameNonce:(0,_.Z)(e,u,"frame_nonce")||"",iframeUrl:Z,isSiteWPForTeams:(0,ue.Z)(e,u),postTypeTrashUrl:g,shouldLoadIframe:j,siteAdminUrl:P,siteId:u,siteSlug:m,siteUrl:(0,pe.Z)(e,u),customizerUrl:(0,fe.Z)(e,u),getTemplateEditorUrl:t=>(0,y.Z)(e,u,t,"wp_template_part"),unmappedSiteUrl:(0,_.Z)(e,u,"unmapped_url"),siteCreationFlow:(0,_.Z)(e,u,"site_creation_flow"),isSiteUnlaunched:(0,me.Z)(e,u),site:(0,ye.Z)(e,u),parentPostId:r}}),$e),R.NC,A.TW)(Re),Ue=()=>{};function Le(e){return e.path.startsWith("/post/")?"post":e.path.startsWith("/page/")?"page":e.params.customPostType}function Ne(e){if(!e.params.post||"new"===e.params.post)return null;if("home"===e.params.post){const t=e.store.getState(),s=(0,S.Z)(t);return parseInt((0,_.Z)(t,s,"page_on_front"),10)}return parseInt(e.params.post,10)}function Oe(e){const t=(0,S.Z)(e);return!(!t||(0,h.a)(e))&&null!==(0,h.Z)(e,t)}const De=(e,t)=>{const s=e.store.getState(),i=(0,S.Z)(s),o=(0,v.Z)(s,i),a=(0,n._k)("desktop"),d=`gutenframe_${i}_is_authenticated`;let l=globalThis.sessionStorage.getItem(d)||!o||o&&k(s,i)||a||e.query.authWpAdmin;if(a&&o&&!k(s,i)&&(l=!1),l)return e.store.dispatch((0,b.LV)(i)),globalThis.sessionStorage.setItem(d,"true"),t();e.primary=c.createElement(ke,null),(0,r.wx)(e,Ue),(0,r.sY)(e);const u=window.location.origin,m=(0,p.Z)({...e.query,authWpAdmin:!0},`${u}${e.path}`),h=(0,T.Z)(s,i),g=(0,p.Z)({redirect_to:m},`${h}/wp-login.php`);window.location.replace(g)},Be=async(e,t)=>{const{store:{getState:s}}=e,i=s(),o=[];(0,I.E)(i,(0,S.Z)(i))||o.push(function(e){return new Promise((t=>{const s=e.store.subscribe((()=>{const i=e.store.getState(),o=(0,S.Z)(i);o&&(0,I.E)(i,o)&&(s(),t())}));e.store.dispatch((0,f.o)((0,S.Z)(e.store.getState())))}))}(e)),Oe(i)||o.push(function(e){return new Promise((t=>{const s=e.store.subscribe((()=>{Oe(e.store.getState())&&(s(),t())}));e.store.dispatch((0,m.u)((0,S.Z)(e.store.getState())))}))}(e)),await Promise.all(o);const r=s(),a=(0,S.Z)(r),n=e.query.is_post_share;if(n&&"true"===n&&!(0,P.Z)(r,a))return t();const d=Le(e);if(!(0,j.Z)(r,a,d)){const t=Ne(e),s=d||!(0,Z.Z)(r,a)?(0,y.Z)(r,a,t,d):(0,w.Z)(r,a);return window.location.replace((0,p.Z)(e.query,s))}return t()};const Ve=(e,t)=>{const s=Ne(e),i=Le(e),o=parseInt((0,d.Z)(e,"query.jetpack-copy",null)),r=Number.isInteger(o)?o:null,a=e.store.getState(),n=(0,S.Z)(a),p=function(e){const{text:t,url:s,title:i,image:o,embed:r}=e;return s?{text:t,url:s,title:i,image:o,embed:r}:null}(e.query),m=function(e){const{anchor_podcast:t,anchor_episode:s,spotify_url:i}=e;return{anchor_podcast:t,anchor_episode:s,spotify_url:i}}(e.query),h=parseInt(e.query.fse_parent_post,10)||null,g=parseInt(e.query.parent_post,10)||null;return e.store.dispatch({type:u.gQI,siteId:n,postId:s}),e.store.dispatch({type:u.oD3,post:{type:i},siteId:n,postId:s}),e.primary=c.createElement(qe,{key:s,postId:s,postType:i,duplicatePostId:r,pressThis:p,anchorFmData:m,fseParentPageId:h,parentPostId:g,creatingNewHomepage:"page"===i&&(0,l.Z)(e,"query.new-homepage"),stripeConnectSuccess:e.query.stripe_connect_success??null}),t()},Ae=(e,t)=>{const s=e.store.getState(),i=(0,S.Z)(s);return e.primary=c.createElement(qe,{key:i,editorType:"site"}),t()},Ge=(e,t)=>{const s=Ne(e),i=(0,S.Z)(e.store.getState());i&&e.store.dispatch((0,g.nF)(i,s)),t()};function ze(){o()("/site-editor/:site?",a.tq,Be,De,Ae,r.wx,r.sY),o()("/post",a.tq,a.tc,r.wx,r.sY),o()("/post/new","/post"),o()("/post/:site/:post?",a.tq,Be,De,Ve,r.wx,r.sY),o().exit("/post/:site?/:post?",Ge),o()("/post/:site?",a.tq,Be,r.wx,r.sY),o()("/page",a.tq,a.tc,r.wx,r.sY),o()("/page/new","/page"),o()("/page/:site/:post?",a.tq,Be,De,Ve,r.wx,r.sY),o().exit("/page/:site?/:post?",Ge),o()("/page/:site?",a.tq,Be,r.wx,r.sY),o()("/edit/:customPostType",a.tq,a.tc,r.wx,r.sY),o()("/edit/:customPostType/:site/:post?",a.tq,Be,De,Ve,r.wx,r.sY),o()("/edit/:customPostType/:site?",a.tq,Be,r.wx,r.sY),o()("/block-editor/","/post"),o()("/block-editor/post/","/post"),o()("/block-editor/post/:site/:post?",(({params:e={}})=>{const{site:t,post:s}=e;if(s)return o().redirect(`/post/${t}/${s}`);o().redirect(`/post/${t}/`)})),o()("/block-editor/page/","/page"),o()("/block-editor/page/:site/:page?",(({params:e={}})=>{const{site:t,page:s}=e;if(s)return o().redirect(`/page/${t}/${s}`);o().redirect(`/page/${t}/`)})),o()("/block-editor/edit/:customPostType/:site/:post?",(({params:e={}})=>{const{customPostType:t,site:s,post:i}=e;if(i)return o().redirect(`/edit/${t}/${s}/${i}`);o().redirect(`/edit/${t}/${s}`)}))}},"./my-sites/customize/panels.js":(e,t,s)=>{s.d(t,{t:()=>o});const i={widgets:["panel","widgets"],fonts:["section","jetpack_fonts"],identity:["section","title_tagline"],"custom-css":["section","jetpack_custom_css"],amp:["section","amp_design"],menus:["panel","nav_menus"],homepage:["section","static_front_page"],jetpack_search:["section","jetpack_search"]};function o(e){if(i.hasOwnProperty(e)){const[t,s]=i[e];return{[`autofocus[${t}]`]:s}}return null}},"./state/editor/actions.js":(e,t,s)=>{s.d(t,{jZ:()=>m,nF:()=>h,DG:()=>g,PB:()=>f,jP:()=>y});var i=s("../node_modules/lodash-es/filter.js"),o=s("./state/action-types.ts"),r=s("./state/analytics/actions/with-analytics.js"),a=s("./state/analytics/actions/bump-stat.js"),n=s("./state/analytics/actions/record.js"),d=s("./state/preferences/actions.js"),l=s("./state/preferences/selectors.js"),c=s("./state/ui/media-modal/actions.js"),p=s("./state/ui/media-modal/constants.js");s("./state/editor/init.js"),s("./state/ui/init.js");const u={[p.b.LIST]:"view_list",[p.b.DETAIL]:"view_detail",[p.b.GALLERY]:"view_gallery",[p.b.IMAGE_EDITOR]:"view_edit",[p.b.VIDEO_EDITOR]:"view_edit"};function m(e,t){return{type:o.gQI,siteId:e,postId:t}}function h(e,t){return{type:o.cnn,siteId:e,postId:t}}function g(e){const t=(0,c.v)(e),s=u[e];return s?(0,r.w)((0,a.P)("editor_media_actions",s),t):t}function f(e,t=!0){return(s,o)=>{const r=(0,l.Oz)(o(),"editorConfirmationDisabledSites");s(t?(0,d.zZ)("editorConfirmationDisabledSites",(0,i.Z)(r,(t=>e!==t))):(0,d.zZ)("editorConfirmationDisabledSites",[...r,e])),s((0,n.jN)(t?"calypso_publish_confirmation_preference_enable":"calypso_publish_confirmation_preference_disable")),s((0,a.P)("calypso_publish_confirmation",t?"enabled":"disabled"))}}const y=(e=!0,t=null)=>({type:o.rQz,isIframeLoaded:e,iframePort:t})},"./state/media/actions.js":(e,t,s)=>{s.d(t,{s0:()=>x,dp:()=>R,e8:()=>$,Uy:()=>O,qB:()=>k,h6:()=>M,hV:()=>C,d5:()=>T,Ap:()=>v,u0:()=>j,t9:()=>P,J_:()=>Z,lh:()=>_,Un:()=>U,r6:()=>q,Kc:()=>L,_L:()=>N,af:()=>E,HU:()=>b,Gn:()=>S});var i=s("./state/action-types.ts"),o=s("../node_modules/debug/src/browser.js"),r=s.n(o),a=s("../packages/i18n-calypso/src/index.js"),n=s("../node_modules/lodash-es/isEqual.js"),d=s("../node_modules/lodash-es/omit.js"),l=s("./state/data-layer/handler-registry.js"),c=s("./state/data-layer/wpcom-http/actions.js"),p=s("./state/data-layer/wpcom-http/utils.js"),u=s("./state/editor/selectors.js");const m=(e,t)=>(s,i)=>{const o=i();if((0,u.cX)(o)){const s=(0,u.Nw)(o);if(!s||!s.postMessage)return;const i=((e,t)=>({id:t.ID,height:t.height,status:e,url:t.URL,width:t.width}))(t,e);s.postMessage({action:"updateImageBlocks",payload:i})}};var h=s("./state/notices/actions.ts"),g=s("./state/selectors/get-next-page-query.js"),f=s("./state/sites/media-storage/actions.js");const y=r()("calypso:middleware-media");const I=({siteId:e},t)=>[P(e,t),m(t,"updated")],w=({siteId:e,originalMediaItem:t})=>[P(e,t),(0,h.tF)((0,a.Iu)("We were unable to process this media item."),{id:`update-media-notice-${t.ID}`})];(0,l.Z9)("state/data-layer/wpcom/sites/media/index.js",{[i.sZU]:[(0,p.BN)({fetch:function(e){y("Request media for site %d using query %o",e.siteId,e.query);const{siteId:t,query:s}=e,i=s&&s.source?`/meta/external-media/${s.source}`:`/sites/${t}/media`;return[(0,c.d)({method:"GET",path:i,apiVersion:"1.1",query:s},e)]},onSuccess:({siteId:e,query:t},s)=>(i,o)=>{(0,n.Z)((0,d.Z)(t,"page_handle"),(0,d.Z)((0,g.Z)(o(),e),"page_handle"))?(i(P(e,s.media,s.found,t)),i(b(e,t)),i(L(e,s.meta))):i(b(e,t))},onError:({siteId:e,query:t})=>j(e,t)})],[i.uz_]:[(0,p.BN)({fetch:function(e){const{mediaId:t,query:s,siteId:i}=e;return y("Request media item %d for site %d",t,i),[(0,c.d)({apiVersion:"1.2",method:"GET",path:`/sites/${i}/media/${t}`,query:s},e)]},onSuccess:({mediaId:e,siteId:t},s)=>[P(t,s),E(t,e)],onError:({mediaId:e,siteId:t})=>v(t,e)})],[i.Lir]:[(0,p.BN)({fetch:function(e){const{siteId:t,item:s}=e;return[(0,h.qq)(`update-media-notice-${s.ID}`),(0,c.d)({method:"POST",path:`/sites/${t}/media/${s.ID}`,apiVersion:"1.1",body:s},e)]},onSuccess:I,onError:w})],[i.QdR]:[(0,p.BN)({fetch:e=>{const{siteId:t,data:s}=e,{ID:i,...o}=s;return[(0,h.qq)(`update-media-notice-${i}`),(0,c.d)({method:"POST",path:`/sites/${t}/media/${i}/edit`,apiVersion:"1.1",formData:Object.entries(o)},e)]},onSuccess:I,onError:w})],[i.o2z]:[(0,p.BN)({fetch:e=>{const{siteId:t,mediaId:s}=e;return[(0,h.qq)(`delete-media-notice-${s}`),(0,c.d)({apiVersion:"1.1",method:"POST",path:`/sites/${t}/media/${s}/delete`},e)]},onSuccess:({siteId:e},t)=>[M(e,t.ID),(0,f.b)(e),m(t,"deleted")],onError:({mediaId:e})=>[(0,h.tF)((0,a.Iu)("We were unable to delete this media item."),{id:`delete-media-notice-${e}`})]})]});s("./state/media/init.js");function P(e,t,s,o){return{type:i.iG7,siteId:e,media:Array.isArray(t)?t:[t],found:s,query:o}}function Z(e,t){return{type:i.sZU,siteId:e,query:t}}function j(e,t,s=null){return{type:i.LEq,siteId:e,query:t,error:s}}function b(e,t){return{type:i.P4e,siteId:e,query:t}}function _(e,t){return{type:i.uz_,siteId:e,mediaId:t}}function v(e,t,s=null){return{type:i.F1b,siteId:e,mediaId:t,error:s}}function E(e,t){return{type:i.l44,siteId:e,mediaId:t}}function k(e,t){return{type:i.TuQ,site:e,transientMedia:t}}const T=(e,t,s,o)=>({type:i.QdR,siteId:e,mediaItem:t,data:s,originalMediaItem:o}),S=(e,t,s)=>({type:i.Lir,siteId:e,item:t,originalMediaItem:s});function M(e,t){return{type:i.aqr,mediaIds:Array.isArray(t)?t:[t],siteId:e}}const C=(e,t)=>({type:i.o2z,siteId:e,mediaId:t});function x(e){return{type:i.EzY,siteId:e}}function R(e,t){return{type:i.c0z,siteId:e,errorType:t}}function $(e,t){return{type:i.LEd,siteId:e,mediaId:t}}function q(e,t,s){return{type:i.zOw,siteId:e,mediaId:t,errors:s}}function U(e,t){return{type:i.OtT,media:t,siteId:e}}function L(e,t){return{type:i.Jfv,siteId:e,mediaRequestMeta:t}}function N(e,t){return{type:i.AsP,siteId:e,query:t}}function O(e){return{type:i._Ck,siteId:e}}},"./state/media/thunks/get-media-item.js":(e,t,s)=>{s.d(t,{Z:()=>o});var i=s("./state/selectors/get-media-item.js");function o(e,t){return(s,o)=>(0,i.Z)(o(),e,t)}},"./state/posts/actions/edit-post.js":(e,t,s)=>{s.d(t,{d:()=>o});var i=s("./state/action-types.ts");s("./state/posts/init.js");function o(e,t=null,s){return{type:i.oD3,post:s,siteId:e,postId:t}}},"./state/posts/revisions/actions.js":(e,t,s)=>{s.d(t,{uz:()=>c,VH:()=>p,o8:()=>d,Ps:()=>n,CK:()=>l,X2:()=>u,Wk:()=>m});var i=s("./state/action-types.ts"),o=s("./state/data-layer/handler-registry.js"),r=s("./state/data-layer/wpcom-http/actions.js");const a=(0,s("./state/data-layer/wpcom-http/utils.js").BN)({fetch:e=>{const{siteId:t,postId:s,postType:i,comparisons:o}=e;return(0,r.d)({apiVersion:"1.2",path:`/sites/${t}/${i}/${s}/diffs`,method:"GET",query:{comparisons:o}},e)},onSuccess:({siteId:e,postId:t},s)=>d({siteId:e,postId:t,...s}),onError:()=>{}});(0,o.Z9)("state/data-layer/wpcom/posts/revisions/index.js",{[i.XB4]:[a]});s("./state/posts/init.js");const n=(e,t,s="posts",o=[])=>({type:i.XB4,comparisons:o,postId:t,postType:s,siteId:e}),d=({diffs:e,postId:t,revisions:s,siteId:o})=>({type:i.vIA,diffs:e,postId:t,revisions:s,siteId:o}),l=e=>({type:i.N__,revisionId:e}),c=()=>({type:i.NYz}),p=()=>({type:i.gpX}),u=()=>({type:i.Se1}),m=()=>({type:i.bE0})},"./state/posts/selectors/get-edited-post-value.js":(e,t,s)=>{s.d(t,{r:()=>r});var i=s("../node_modules/lodash-es/get.js"),o=s("./state/posts/selectors/get-edited-post.js");s("./state/posts/init.js");function r(e,t,s,r){return(0,i.Z)((0,o.P)(e,t,s),r)}},"./state/selectors/get-next-page-handle.js":(e,t,s)=>{s.d(t,{Z:()=>o});var i=s("../node_modules/lodash-es/get.js");s("./state/media/init.js");function o(e,t){return(0,i.Z)(e.media.fetching,[t,"nextPageHandle"])}},"./state/selectors/get-next-page-query.js":(e,t,s)=>{s.d(t,{Z:()=>r});s("./state/media/init.js");var i=s("./state/selectors/get-next-page-handle.js");const o=Object.freeze({number:20});function r(e,t){if(!(t in e.media.fetching))return o;const s=function(e,t){return e.media.fetching[t]?.query??null}(e,t),r=(0,i.Z)(e,t);return["string","number"].includes(typeof r)?{...o,...s,page_handle:r}:{...o,...s}}},"./state/selectors/get-selected-editor.js":(e,t,s)=>{s.d(t,{E:()=>n});var i=s("../node_modules/lodash-es/get.js"),o=s("../packages/calypso-config/src/index.ts"),r=s("./state/selectors/is-vip-site.js");s("./state/selected-editor/init.js");const a=(e,t)=>{const s=(0,i.Z)(e,["selectedEditor",t],null);return!(!(0,o._k)("desktop")||!["gutenberg-redirect","gutenberg-redirect-and-style"].includes(s))||!!(0,r.Z)(e,t)},n=(e,t)=>{const s=(0,i.Z)(e,["selectedEditor",t],null);return["gutenberg-iframe","gutenberg-redirect","gutenberg-redirect-and-style","classic"].includes(s)?a(e,t)?"classic":s:null}},"./state/selectors/get-site-editor-url.js":(e,t,s)=>{s.d(t,{Z:()=>a});var i=s("./state/selectors/should-load-gutenframe.js"),o=s("./state/sites/selectors/get-site-admin-url.js"),r=s("./state/sites/selectors/get-site-slug.js");const a=(e,t)=>{const s=(0,o.Z)(e,t);if(!(0,i.F)(e,t))return`${s}admin.php?page=gutenberg-edit-site`;return`/site-editor/${(0,r.Z)(e,t)}`}},"./state/selectors/is-site-using-core-site-editor.js":(e,t,s)=>{s.d(t,{Z:()=>o});var i=s("./state/selectors/get-raw-site.js");function o(e,t){return(0,i.Z)(e,t)?.is_core_site_editor_enabled??!1}},"./state/sites/media-storage/actions.js":(e,t,s)=>{s.d(t,{P:()=>d,b:()=>n});var i=s("./state/action-types.ts"),o=s("./state/data-layer/handler-registry.js"),r=s("./state/data-layer/wpcom-http/actions.js"),a=s("./state/data-layer/wpcom-http/utils.js");function n(e){return{type:i.r9W,siteId:e}}function d(e,t){return{type:i.uin,mediaStorage:e,siteId:t}}(0,o.Z9)("state/data-layer/wpcom/sites/media-storage/index.js",{[i.r9W]:[(0,a.BN)({fetch:function(e){return[(0,r.d)({method:"GET",path:`/sites/${e.siteId}/media-storage`,apiVersion:"1.1"},e)]},onSuccess:({siteId:e},t)=>[d(t,e),{type:i.PXi,siteId:e}],onError:({siteId:e},t)=>[{type:i.$U1,siteId:e,error:t}]})]})},"./state/sites/selectors/get-customizer-url.js":(e,t,s)=>{s.d(t,{Z:()=>d});var i=s("./lib/url/add-query-args.ts"),o=s("./my-sites/customize/panels.js"),r=s("./state/sites/selectors/get-site-admin-url.js"),a=s("./state/sites/selectors/get-site-slug.js"),n=s("./state/sites/selectors/is-jetpack-site.js");function d(e,t,s,d,l){if(!(0,n.Z)(e,t)){const o=(0,a.Z)(e,t),r=[""].concat(["customize",s,o].filter(Boolean)).join("/");return(0,i.Z)({return:d,guide:l},r)}const c=(0,r.Z)(e,t,"customize.php");return c?(d||"undefined"==typeof window||(d=window.location.href),(0,i.Z)({return:d,...(0,o.t)(s),guide:l},c)):null}},"./state/sites/selectors/get-site-url.js":(e,t,s)=>{s.d(t,{Z:()=>n});var i=s("./state/selectors/get-raw-site.js"),o=s("./state/sites/selectors/get-site-option.js"),r=s("./state/sites/selectors/get-site-slug.js"),a=s("./state/sites/selectors/is-site-conflicting.js");function n(e,t){if((0,o.Z)(e,t,"is_redirect")||(0,a.Z)(e,t))return(0,r.Z)(e,t);const s=(0,i.Z)(e,t);return s?s.URL:null}},"./state/ui/media-modal/actions.js":(e,t,s)=>{s.d(t,{v:()=>o,M:()=>r});var i=s("./state/action-types.ts");s("./state/ui/init.js");function o(e){return{type:i.WkZ,view:e}}function r(){return o(null)}},"./state/ui/media-modal/constants.js":(e,t,s)=>{s.d(t,{b:()=>i});const i={LIST:"LIST",DETAIL:"DETAIL",GALLERY:"GALLERY",IMAGE_EDITOR:"IMAGE_EDITOR",VIDEO_EDITOR:"VIDEO_EDITOR"}}}]);